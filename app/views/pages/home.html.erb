<!-- app/views/pages/home.html.erb -->

<!-- Navbar -->
<%# <%= render 'shared/navbar' %>

<!-- Carrusel que ocupa todo el ancho -->
<div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel" style="height: 500px;">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner" style="height: 500px;">
    <div class="carousel-item active">
      <img src="http://enrsto.freehostia.com/enriquestolar.com/img/carrusel-encuentramascotas-2_fb.png" class="d-block w-100" alt="Mascotas Felices" style="object-fit: cover; height: 100%; display: block;">
      <div class="carousel-caption d-none d-md-block">
        <h5>Mascotas Felices</h5>
        <p>Encuentra y reúne a las mascotas perdidas con sus familias.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="http://enrsto.freehostia.com/enriquestolar.com/img/carrusel-encuentramascotas-1_fb.png" class="d-block w-100" alt="Cuidado y Protección" style="object-fit: cover; height: 100%; display: block;">
      <div class="carousel-caption d-none d-md-block">
        <h5>Cuidado y Protección</h5>
        <p>Protege a las mascotas de tu comunidad y comparte información importante.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="http://enrsto.freehostia.com/enriquestolar.com/img/carrusel-encuentramascotas-3_fb.png" class="d-block w-100" alt="Adopta una Mascota" style="object-fit: cover; height: 100%; display: block;">
      <div class="carousel-caption d-none d-md-block">
        <h5>Adopta una Mascota</h5>
        <p>Dale una segunda oportunidad a una mascota necesitada.</p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>

<!-- Botón Mascotas Perdidas -->
<div class="d-flex justify-content-center mb-3">
  <div class="mx-2">
    <!-- Botón Mascotas Perdidas -->
    <%= link_to 'Mascotas Perdidas', petlosts_path, class: 'btn btn-primary custom-btn-lost' %>
  </div>
  <div class="mx-2">
    <!-- Botón Mascotas Encontradas -->
    <%= link_to 'Mascotas Encontradas', petfounds_path, class: 'btn btn-success custom-btn-found' %>
  </div>
</div>

<!-- Cards de Mascotas Perdidas -->
<section class="container mt-5">
  <h2 class="text-center">Mascotas Perdidas</h2>
  <div class="row g-3"> <!-- Agregamos g-3 para espacio entre las tarjetas -->
    <% if @petlosts.present? %>

      <% @petlosts.each do |pet| %>

    <% if pet.color.present? %>
      <% colors_array = JSON.parse(pet.color).reject(&:blank?) %>

      <% if colors_array.size == 1 %>
        <% text = colors_array.join %>
        <% else %>
        <% text = colors_array.join(", ") %>
      <% end %>
    <% end %>



        <div class="col-md-3">
          <div class="card mb-4 shadow-sm">
            <% if pet.photos.attached? %>
              <%= image_tag pet.photos.first, class: 'card-img-top pet-image', alt: pet.name %>
            <% else %>
              <%= image_tag 'default-image.png', class: 'card-img-top pet-image', alt: 'No image available' %>
            <% end %>
            <div class="card-body">
              <h5 class="card-title"><%= pet.name %></h5>
              <p class="card-text"><%= truncate(
                text,
                length: 100) %></p>
              <%= link_to 'Ver más', petlost_path(pet), class: 'btn btn-success text-white' %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <p>No hay mascotas perdidas disponibles.</p>
    <% end %>
  </div>
</section>

<!-- Nueva Sección sobre la App Encuentra Mascotas -->
<section class="container app-info-section mt-5">
  <div class="row align-items-center">
    <div class="col-md-6">
      <img src="<%= asset_path('http://enrsto.freehostia.com/enriquestolar.com/img/app-encuentra-mascotas.png') %>" class="img-fluid" alt="Encuentra Mascotas App">
    </div>
    <div class="col-md-6">
      <h2 class="section-title">Encuentra Mascotas: Conectando a las Mascotas Perdidas con sus Dueños</h2>
      <p class="section-text">
        Con nuestra tecnología avanzada y geolocalización en tiempo real, Encuentra Mascotas ofrece una solución rápida y efectiva para la búsqueda y el reporte de mascotas perdidas. Únete a nuestra comunidad para ayudar a reunir a las mascotas con sus dueños.
      </p>
      <p class="section-text">
        La aplicación es fácil de usar, permite el reporte inmediato de mascotas perdidas y encontradas, además de la búsqueda avanzada de mascotas en adopción. ¡Sé parte de la solución!
      </p>
      <%= link_to 'Ver más', app_info_path, class: 'btn btn-primary btn-large' %>
    </div>
  </div>
</section>


<!-- Cards de Mascotas Encontradas -->
<section class="container mt-5">
  <h2 class="text-center">Mascotas Encontradas</h2>
  <div class="row">
    <% if @found_pets.present? %> <!-- Evitar errores si no hay mascotas encontradas -->
      <% @found_pets.each do |pet| %>
        <div class="col-md-3">
          <div class="card mb-4 shadow-sm">
            <%= image_tag pet.image_url, class: 'card-img-top', alt: pet.name %> <!-- pet.image_url debe existir -->
            <div class="card-body">
              <h5 class="card-title"><%= pet.name %></h5> <!-- pet.name debe existir -->
              <p class="card-text"><%= truncate(pet.description, length: 100) %> <!-- pet.description debe existir -->
              <!-- <%= link_to 'Ver más', pet_path(pet), class: 'btn btn-primary' %> --> <!-- Comentado hasta que pet_path esté definido -->
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <p>No hay mascotas encontradas disponibles.</p> <!-- Mensaje alternativo si no hay datos -->
    <% end %>
  </div>
</section>

<!-- Reviews de Usuarios -->
<section class="container mt-5">
  <h2 class="text-center">Personas que han encontrado a sus mascotas</h2>
  <div class="row">
    <% if @reviews.present? %> <!-- Evitar errores si no hay reseñas -->
      <% @reviews.each do |review| %>
        <div class="col-md-4">
          <div class="card mb-4 shadow-sm">
            <div class="card-body">
              <h5 class="card-title"><%= review.user_name %></h5> <!-- review.user_name debe existir -->
              <p class="card-text"><%= review.content %></p> <!-- review.content debe existir -->
              <div class="rating">
                <% review.stars.times do %>
                  <i class="fa fa-star"></i>
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <p>No hay reseñas disponibles.</p> <!-- Mensaje alternativo si no hay reseñas -->
    <% end %>
  </div>
</section>
