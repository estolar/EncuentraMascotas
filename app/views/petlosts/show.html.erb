<div class="container">
  <!-- Fila A: Nombre del perro -->
  <div class="row align-items-center" style="height: 15vh;">
    <div class="col text-center">
      <h1 class="display-4"><%= @petlost.name %></h1>
      Perdido el: <%= @petlost.day_lost %><br>
    </div>
  </div>

  <!-- Fila B: Mapa -->
  <div class="row">
    <div class="col text-center">
      <div class="card p-3 mb-4" style="box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);">
        <div id="map" style="height: 350px; width: 100%;"></div> <!-- Mapa ocupa más espacio -->
      </div>
    </div>
  </div>

  <!-- Fila C: Dos columnas de igual tamaño -->
  <div class="row">
    <!-- Columna Datos Dueño -->
    <div class="col-md-6">
      <div class="card h-100 mt-4" style="box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);">
        <!-- Fila C1 dentro de la columna Datos Dueño -->
        <div class="row align-items-center" style="height: 50%;">
          <!-- Columna con los datos del dueño -->
          <div class="col-8 text-center">
            <div class="card m-3" style="height: 100%;"> <!-- Ajuste para que el contenido ocupe todo el espacio -->
              <h4 class="mb-2" style="font-size: 2rem;">Datos del dueño</h4>
              <p style="font-size: 1.0rem;"><strong>Nombre:</strong> <%= @petlost.user.name %></p>
              <p style="font-size: 1.0rem;"><strong>Correo:</strong> <%= @petlost.user.email %></p>
              <p style="font-size: 1.0rem;"><strong>Teléfono:</strong> <%= @petlost.user.phone_number %></p>
            </div>
          </div>
          <!-- Columna para la foto del dueño -->
          <div class="col-4 text-center">
            <% if @petlost.user.photo.attached? %>
              <%= image_tag @petlost.user.photo, class: "img-fluid rounded-circle", style: "width: 100px; height: 100px; object-fit: cover;" %>
            <% end %>
          </div>
        </div>

        <!-- Fila C2 dentro de la columna Datos Perro -->
        <div class="row align-items-center" style="height: 50%;">
          <!-- Columna con los datos del perro a la izquierda -->
          <div class="col-8 text-center">
            <div class="card m-3" style="height: 100%;"> <!-- Ajuste para que el contenido ocupe todo el espacio -->
              <h4 class="mb-2" style="font-size: 2rem;">Datos del Perro</h4>
              <p style="font-size: 1.0rem;"><strong>Raza:</strong> <%= @petlost.breed %></p>
              <p style="font-size: 1.0rem;"><strong>Perdido el:</strong> <%= @petlost.day_lost %></p>
              <p style="font-size: 1.0rem;"><strong>Se perdió en:</strong> <%= @petlost.address %></p>
            </div>
          </div>
          <!-- Columna con el icono del perro a la derecha -->
          <div class="col-4 text-center">
            <!-- Icono del perro -->
            <i class="fas fa-dog" style="font-size: 50px; color: gray;"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Columna Fotos Carrusel -->
    <div class="col-md-6 text-center">
      <!-- Card que contiene el carrusel -->
      <div class="card p-3 mt-4" style="box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); height: 100%;">
        <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
          <div class="carousel-inner">
            <% @petlost.photos.each_with_index do |photo, index| %>
              <div class="carousel-item <%= index == 0 ? 'active' : '' %>">
                <%= cl_image_tag(photo.key, class: "d-block w-100", style: "height: 300px; object-fit: cover;") %>
              </div>
            <% end %>
          </div>
          <!-- Controles de navegación -->
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Fila D: Iconos -->
  <div class="row align-items-center" style="height: 5vh;">
    <div class="col text-center">
      <!-- Aquí puedes añadir iconos o botones adicionales si es necesario -->
    </div>
  </div>
</div>

<script>
  document.addEventListener('turbo:load', function() {
    mapboxgl.accessToken = '<%= ENV['MAPBOX_API_KEY'] %>';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [<%= @petlost.longitude %>, <%= @petlost.latitude %>],
      zoom: 15,
      pitch: 45,
      bearing: -17.6
    });

    const el = document.createElement('div');
    el.className = 'marker';
    el.style.backgroundImage = 'url(<%= asset_path("icon.png") %>)';
    el.style.width = '40px';
    el.style.height = '40px';
    el.style.backgroundSize = '100%';

    // Crear el marcador personalizado
    new mapboxgl.Marker(el)
      .setLngLat([<%= @petlost.longitude %>, <%= @petlost.latitude %>])
      .addTo(map);

    map.on('load', function () {
      map.addLayer({
        'id': '3d-buildings',
        'source': 'composite',
        'source-layer': 'building',
        'filter': ['==', 'extrude', 'true'],
        'type': 'fill-extrusion',
        'minzoom': 15,
        'paint': {
          'fill-extrusion-color': '#CCA691',
          'fill-extrusion-height': [
            'interpolate', ['linear'], ['zoom'],
            15, 0,
            16.05, ['get', 'height']
          ],
          'fill-extrusion-base': [
            'interpolate', ['linear'], ['zoom'],
            15, 0,
            16.05, ['get', 'min_height']
          ],
          'fill-extrusion-opacity': 0.6
        }
      });
    });
  });
</script>
