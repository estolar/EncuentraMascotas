<%= link_to 'Volver a la lista', petfounds_path, class: "btn btn-primary" %>
<%= link_to 'Eliminar', petfound_path(@petfound), class: "btn btn-danger", data: { turbo_method: :delete, turbo_confirm: "¿Seguro que quieres eliminar?" } %>
<%= link_to 'Editar', edit_petfound_path, class: "btn btn-primary" %>


<div class = "container">



<div class = 'row'>
  <div class = 'col-4'>

      <%# carrusel %>
        <div class = "contenedor-carrusel">
          <div id="carouselExample" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
              <% @petfound.photos.each_with_index do |photo, index| %>
                <div class="carousel-item <%= 'active' if index == 0 %>">
                  <%= cl_image_tag photo.key, crop: :fill, class: "d-block w-100" %>
                </div>
              <% end %>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
      <%# fin carrusel %>

      <p> Detalles: <%= @petfound.details %></p>
<p>Raza: <%= @petfound.breed %></p>
  <% if @petfound.color.present? %>
    <% colors_array = JSON.parse(@petfound.color).reject(&:blank?) %>

    <% if colors_array.size == 1 %>
      <p>Color: <%= colors_array.join %></p>
      <% else %>
      <p>Color: <%= colors_array.join(", ") %></p>
    <% end %>
  <% end %>
<p>Señas particulares: <%= @petfound.signs %></p>
<p>Encontrado el: <%= @petfound.day_found %></p>
<p>Dirección donde fue encontrado: <%= @petfound.address %></p>


  </div>
</div>


</div>


<div class="card mb-4" style="width: 50%; margin: 0 auto;">
  <div id="map" style="height: 300px; width: 100%;"></div>
</div>

<script>
  document.addEventListener('turbo:load', function() {
    mapboxgl.accessToken = '<%= ENV['MAPBOX_API_KEY'] %>';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11',
      center: [<%= @petfound.longitude %>, <%= @petfound.latitude %>],
      zoom: 15,
      pitch: 45,
      bearing: -17.6
    });

    const el = document.createElement('div');
    el.className = 'marker';
    el.style.backgroundImage = 'url(<%= asset_path("heart.png") %>)';
    el.style.width = '40px';
    el.style.height = '40px';
    el.style.backgroundSize = '100%';

    // Crear el marcador personalizado
    new mapboxgl.Marker(el)
      .setLngLat([<%= @petfound.longitude %>, <%= @petfound.latitude %>])
      .addTo(map);

    map.on('load', function () {
      map.addLayer({
        'id': '3d-buildings',
        'source': 'composite',
        'source-layer': 'building',
        'filter': ['==', 'extrude', 'true'],
        'type': 'fill-extrusion',
        'minzoom': 15,
        'paint': {
          'fill-extrusion-color': '#CCA691',
          'fill-extrusion-height': [
            'interpolate', ['linear'], ['zoom'],
            15, 0,
            16.05, ['get', 'height']
          ],
          'fill-extrusion-base': [
            'interpolate', ['linear'], ['zoom'],
            15, 0,
            16.05, ['get', 'min_height']
          ],
          'fill-extrusion-opacity': 0.6
        }
      });
    });
  });
</script>
